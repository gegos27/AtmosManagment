<!doctype html>
<html lang="he" dir="rtl" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ATMOS - × ×™×”×•×œ × ×¨×’×™×œ×•×ª</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;500;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
    body { box-sizing: border-box; font-family: 'Assistant', sans-serif; background-color: #0f172a; margin: 0; padding: 0; }
    .table-card { transition: all 0.2s ease; border-top-width: 4px; }
    .status-closed { filter: grayscale(1); opacity: 0.6; }
    .tab-active { background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); color: white; }
    .modal-backdrop { background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(5px); }
    .menu-item-btn:active { transform: scale(0.95); }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .timer-warning { animation: pulse 1s infinite; color: #f87171; }
  </style>
 </head>
 <body class="h-full text-gray-100 overflow-hidden">
  
  <div id="app" class="h-full flex flex-col">
   <header class="bg-gray-900 border-b border-gray-800 px-6 py-4 flex items-center justify-between shadow-xl">
    <div class="flex items-center gap-3">
     <div class="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center">
      <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 3v18M12 3l-4 4M12 3l4 4" stroke-width="2" stroke-linecap="round"/></svg>
     </div>
     <h1 class="text-xl font-black tracking-widest text-white uppercase">ATMOS LOUNGE</h1>
    </div>
    <div class="flex items-center gap-4">
     <div id="staff-display" class="bg-gray-800 px-3 py-1.5 rounded-lg border border-gray-700 text-sm">
        ×¢×•×‘×“: <span id="current-staff-name" class="font-bold text-indigo-400">×× ×”×œ</span>
        <button onclick="changeUser()" class="mr-2 text-xs text-gray-500 hover:text-white underline">×”×—×œ×£</button>
     </div>
    </div>
   </header>

   <nav class="bg-gray-900 px-4 py-2 flex gap-2 border-b border-gray-800 shadow-md">
     <button onclick="switchTab('tables')" id="tab-tables" class="tab-btn tab-active px-4 py-2 rounded-lg text-sm font-bold transition-all">ğŸª‘ ×©×•×œ×—× ×•×ª</button>
     <button onclick="switchTab('inventory')" id="tab-inventory" class="tab-btn bg-gray-800 px-4 py-2 rounded-lg text-sm font-bold transition-all">ğŸ“¦ ××œ××™</button>
     <button onclick="switchTab('daily')" id="tab-daily" class="tab-btn bg-gray-800 px-4 py-2 rounded-lg text-sm font-bold transition-all">ğŸ“Š ×¡×™×›×•×</button>
   </nav>

   <main class="flex-1 p-4 overflow-y-auto">
    <div id="view-tables" class="view-content">
     <div class="flex items-center justify-between mb-6">
      <h2 class="text-lg font-bold text-gray-400">×©×•×œ×—× ×•×ª ×¤×¢×™×œ×™×</h2>
      <button onclick="openAddTableModal()" class="bg-indigo-600 hover:bg-indigo-500 px-5 py-2 rounded-xl font-bold shadow-lg shadow-indigo-500/20">
       + ×¤×ª×— ×©×•×œ×—×Ÿ
      </button>
     </div>
     <div id="tables-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4"></div>

     <div class="mt-12 pt-8 border-t border-gray-800">
        <h2 class="text-lg font-bold text-gray-600 mb-4">×©×•×œ×—× ×•×ª ×¡×’×•×¨×™× (×”×™×•×)</h2>
        <div id="closed-tables-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4"></div>
     </div>
    </div>

    <div id="view-inventory" class="view-content hidden">
      <div id="inventory-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
    </div>

    <div id="view-daily" class="view-content hidden">
        <div class="max-w-md mx-auto bg-gray-800 rounded-3xl p-6 border border-gray-700 shadow-2xl">
            <h2 class="text-2xl font-black mb-6 text-center text-indigo-400 uppercase">×¡×™×›×•× ××©××¨×ª</h2>
            <div class="space-y-4 mb-8">
                <div class="flex justify-between p-4 bg-gray-900 rounded-2xl"><span class="text-gray-400">×”×›× ×¡×” ×›×•×œ×œ×ª:</span><span id="daily-revenue" class="font-bold text-green-400 text-xl">â‚ª0</span></div>
                <div class="flex justify-between p-4 bg-gray-900 rounded-2xl"><span class="text-gray-400">×”×–×× ×•×ª:</span><span id="daily-orders" class="font-bold text-indigo-400 text-xl">0</span></div>
                <div class="flex justify-between p-4 bg-gray-900 rounded-2xl text-sm"><span class="text-gray-400">××–×•××Ÿ / ××©×¨××™:</span><span id="daily-split" class="font-bold">â‚ª0 / â‚ª0</span></div>
            </div>
            <button onclick="resetDay()" class="w-full bg-red-600/10 text-red-500 py-3 rounded-xl font-bold hover:bg-red-600 hover:text-white transition-all">××™×¤×•×¡ × ×ª×•× ×™× ×œ××©××¨×ª ×—×“×©×”</button>
        </div>
    </div>
   </main>
  </div>

  <div id="modal-container" class="hidden fixed inset-0 z-50 modal-backdrop flex items-center justify-center p-4" onclick="handleBackdropClick(event)">
   <div id="modal-content" class="bg-gray-900 rounded-3xl max-w-lg w-full max-h-[90vh] overflow-y-auto border border-gray-700 shadow-2xl" onclick="event.stopPropagation()"></div>
  </div>

  <script>
    // --- Data Management ---
    const menuItems = [
      { id: 'fav1', name: 'Pinkman', price: 85, cat: '××•×¢×“×¤×™×' },
      { id: 'fav2', name: 'Lemon Mint', price: 80, cat: '××•×¢×“×¤×™×' },
      { id: 'm1', name: 'Purple Skitlzz', price: 80, cat: 'Mono' },
      { id: 'm2', name: 'Tik Tak', price: 80, cat: 'Mono' },
      { id: 'mx1', name: 'chill%thrill', price: 95, cat: '××™×§×¡×™×' },
      { id: 'mx2', name: 'frooty sunset', price: 95, cat: '××™×§×¡×™×' },
      { id: 'ds1', name: 'Cosmo Flower', price: 90, cat: 'Darkside' },
      { id: 'mh1', name: 'Nord Star', price: 90, cat: 'Musthave' }
      // × ×™×ª×Ÿ ×œ×”×•×¡×™×£ ×›××Ÿ ××ª ×©××¨ ×”×¨×©×™××” ×‘×§×œ×•×ª
    ];

    const STAGES = [{n:'×”×›× ×”', d:10*60}, {n:'×¢×™×©×•×Ÿ', d:40*60}, {n:'×¡×™×•×', d:10*60}];

    let tables = JSON.parse(localStorage.getItem('atmos_tables')) || [];
    let daily = JSON.parse(localStorage.getItem('atmos_daily')) || { rev: 0, count: 0, cash: 0, credit: 0 };

    // --- Core Functions ---
    function init() {
        render();
        setInterval(tick, 1000);
    }

    function render() {
        const grid = document.getElementById('tables-grid');
        const closed = document.getElementById('closed-tables-grid');
        grid.innerHTML = ''; closed.innerHTML = '';

        tables.forEach(t => {
            const hue = t.hue || 200;
            const color = t.paid ? '#4b5563' : `hsl(${hue}, 70%, 50%)`;
            const el = document.createElement('div');
            el.className = `table-card bg-gray-800/50 p-4 rounded-2xl border border-gray-700 cursor-pointer ${t.paid ? 'status-closed' : ''}`;
            el.style.borderTopColor = color;
            el.onclick = () => openTableModal(t.id);
            el.innerHTML = `
                <div class="text-[10px] text-gray-500 mb-2">#${t.id.slice(-4)}</div>
                <div class="font-black text-lg mb-1">${t.name}</div>
                <div class="text-xs font-bold text-indigo-400">${getTimerText(t)}</div>
            `;
            (t.paid ? closed : grid).appendChild(el);
        });

        document.getElementById('daily-revenue').textContent = `â‚ª${daily.rev}`;
        document.getElementById('daily-orders').textContent = daily.count;
        document.getElementById('daily-split').textContent = `â‚ª${daily.cash} / â‚ª${daily.credit}`;
        
        const invGrid = document.getElementById('inventory-grid');
        invGrid.innerHTML = menuItems.map(i => `<div class="bg-gray-800 p-3 rounded-xl border border-gray-700 text-center"><div class="text-[10px] text-indigo-400 font-bold uppercase">${i.cat}</div><div class="text-sm font-bold">${i.name}</div></div>`).join('');
    }

    function getTimerText(t) {
        if (!t.start || t.paid) return '×¤× ×•×™';
        const s = t.stage || 0;
        if (s >= STAGES.length) return '××•×›×Ÿ';
        const rem = Math.max(0, STAGES[s].d - Math.floor((Date.now() - t.start) / 1000));
        const m = Math.floor(rem/60), sec = rem%60;
        return `<span class="${rem < 60 ? 'timer-warning' : ''}">${STAGES[s].n}: ${m}:${sec < 10 ? '0'+sec : sec}</span>`;
    }

    function tick() {
        let changed = false;
        tables.forEach(t => {
            if (t.start && !t.paid) {
                const s = t.stage || 0;
                if (s < STAGES.length && (Date.now() - t.start)/1000 >= STAGES[s].d) {
                    t.stage = s + 1;
                    t.start = Date.now();
                    changed = true;
                }
            }
        });
        if (changed) save();
        render();
    }

    // --- UI Interactions ---
    function openAddTableModal() {
        const modal = document.getElementById('modal-content');
        modal.innerHTML = `
            <div class="p-8">
                <h2 class="text-xl font-black mb-4">×¤×ª×™×—×ª ×©×•×œ×—×Ÿ</h2>
                <input type="text" id="in-name" placeholder="×©×/××¡×¤×¨ ×©×•×œ×—×Ÿ" class="w-full bg-gray-800 border border-gray-700 rounded-xl p-4 text-white mb-4 focus:border-indigo-500 outline-none">
                <button onclick="addTable()" class="w-full bg-indigo-600 py-4 rounded-xl font-bold">××™×©×•×¨</button>
            </div>
        `;
        showModal();
    }

    function addTable() {
        const name = document.getElementById('in-name').value;
        if (!name) return;
        tables.push({ id: 't'+Date.now(), name, hue: Math.floor(Math.random()*360), items: [], paid: false, stage: 0, start: null });
        save(); closeModal(); render();
    }

    function openTableModal(id) {
        const t = tables.find(x => x.id === id);
        const total = t.items.reduce((a,b) => a + (b.price * b.qty), 0);
        const modal = document.getElementById('modal-content');
        modal.innerHTML = `
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-black">${t.name}</h2>
                    <button onclick="closeModal()" class="text-gray-500 text-2xl">âœ•</button>
                </div>
                <div class="bg-gray-800 p-4 rounded-2xl mb-6 flex justify-between items-center">
                    <div><div class="text-[10px] text-gray-500 font-bold uppercase">×¡×˜×˜×•×¡</div><div class="font-bold">${getTimerText(t)}</div></div>
                    ${!t.paid && t.start ? `<button onclick="skipStage('${t.id}')" class="bg-indigo-600/20 text-indigo-400 px-3 py-1 rounded-lg text-xs font-bold">×“×œ×’ ×©×œ×‘ â”</button>` : ''}
                </div>
                <div class="mb-6">
                    <div class="text-xs font-bold text-gray-500 uppercase mb-2">×”×–×× ×” (â‚ª${total})</div>
                    <div class="space-y-2 max-h-32 overflow-y-auto mb-4">${t.items.map(i => `<div class="flex justify-between bg-gray-800 p-2 rounded-lg text-sm"><span>${i.name} x${i.qty}</span><button onclick="removeItem('${t.id}','${i.id}')" class="text-red-500">××—×§</button></div>`).join('')}</div>
                    <div class="grid grid-cols-2 gap-2 h-32 overflow-y-auto border-t border-gray-800 pt-2">
                        ${menuItems.map(m => `<button onclick="addItem('${t.id}','${m.id}')" class="bg-gray-800 p-2 rounded-lg text-[10px] text-right">${m.name}</button>`).join('')}
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    ${!t.start && !t.paid ? `<button onclick="startTable('${t.id}')" class="col-span-2 bg-indigo-600 py-4 rounded-xl font-bold">×”×ª×—×œ ××©××¨×ª</button>` : 
                      t.paid ? `<button onclick="deleteTable('${t.id}')" class="col-span-2 bg-red-600/20 text-red-500 py-3 rounded-xl">××—×§ ××”×¨×©×™××”</button>` : 
                      `<button onclick="payModal('${t.id}')" class="col-span-2 bg-green-600 py-4 rounded-xl font-bold">×œ×ª×©×œ×•× â‚ª${total}</button>`}
                </div>
            </div>
        `;
        showModal();
    }

    function startTable(id) { 
        const t = tables.find(x => x.id === id); 
        t.start = Date.now(); t.stage = 0; 
        save(); openTableModal(id); 
    }

    function skipStage(id) {
        const t = tables.find(x => x.id === id);
        t.stage++; t.start = Date.now();
        save(); openTableModal(id);
    }

    function addItem(tid, mid) {
        const t = tables.find(x => x.id === tid), m = menuItems.find(x => x.id === mid);
        const ex = t.items.find(x => x.id === mid);
        if (ex) ex.qty++; else t.items.push({...m, qty:1});
        save(); openTableModal(tid);
    }

    function removeItem(tid, mid) {
        const t = tables.find(x => x.id === tid);
        t.items = t.items.filter(x => x.id !== mid);
        save(); openTableModal(tid);
    }

    function payModal(id) {
        const t = tables.find(x => x.id === id);
        const total = t.items.reduce((a,b) => a + (b.price * b.qty), 0);
        const modal = document.getElementById('modal-content');
        modal.innerHTML = `
            <div class="p-8 text-center">
                <div class="text-4xl font-black mb-2 text-indigo-400">â‚ª${total}</div>
                <p class="text-gray-500 mb-8">×¡×’×™×¨×ª ×©×•×œ×—×Ÿ ${t.name}</p>
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="finishPay('${id}','cash',${total})" class="bg-gray-800 p-6 rounded-2xl font-bold">ğŸ’µ ××–×•××Ÿ</button>
                    <button onclick="finishPay('${id}','credit',${total})" class="bg-gray-800 p-6 rounded-2xl font-bold">ğŸ’³ ××©×¨××™</button>
                </div>
            </div>
        `;
    }

    function finishPay(id, method, amt) {
        const t = tables.find(x => x.id === id);
        t.paid = true; t.start = null;
        daily.rev += amt; daily.count++;
        if (method === 'cash') daily.cash += amt; else daily.credit += amt;
        localStorage.setItem('atmos_daily', JSON.stringify(daily));
        save(); closeModal(); render();
    }

    function deleteTable(id) { tables = tables.filter(x => x.id !== id); save(); closeModal(); render(); }
    
    function resetDay() { if(confirm("×œ××¤×¡ ××ª ×›×œ ×”× ×ª×•× ×™×?")) { localStorage.clear(); location.reload(); } }
    
    function save() { localStorage.setItem('atmos_tables', JSON.stringify(tables)); }
    function showModal() { document.getElementById('modal-container').classList.remove('hidden'); }
    function closeModal() { document.getElementById('modal-container').classList.add('hidden'); }
    function handleBackdropClick(e) { if(e.target.id === 'modal-container') closeModal(); }
    
    function switchTab(id) {
        document.querySelectorAll('.view-content').forEach(v => v.classList.add('hidden'));
        document.getElementById('view-'+id).classList.remove('hidden');
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('tab-active', 'bg-gray-800'));
        document.getElementById('tab-'+id).classList.add('tab-active');
    }

    function changeUser() { const n = prompt("×©× ×¢×•×‘×“:"); if(n) document.getElementById('current-staff-name').textContent = n; }

    init();
  </script>
 </body>
</html>
