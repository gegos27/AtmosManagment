<!doctype html>
<html lang="he" dir="rtl" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ATMOS - × ×™×”×•×œ × ×¨×’×™×œ×•×ª</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;500;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
    body { box-sizing: border-box; font-family: 'Assistant', sans-serif; background-color: #0f172a; color: white; margin: 0; }
    .table-card { transition: all 0.3s ease; }
    .tab-active { background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); color: white; }
    .modal-backdrop { background: rgba(0, 0, 0, 0.95); backdrop-filter: blur(12px); }
    .timer-warning { animation: pulse 1s ease-in-out infinite; color: #f87171; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
    .scrollbar-thin::-webkit-scrollbar { width: 5px; height: 5px; }
    .scrollbar-thin::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    .category-label { border-right: 3px solid #6366f1; padding-right: 8px; margin: 12px 0 6px 0; font-weight: 800; font-size: 0.75rem; color: #a5b4fc; text-transform: uppercase; }
  </style>
 </head>
 <body class="h-full overflow-hidden">
  <div id="app" class="h-full flex flex-col">
   <header class="bg-gray-900 border-b border-gray-800 px-6 py-4 flex items-center justify-between shadow-2xl">
     <div class="flex items-center gap-4">
        <h1 class="text-2xl font-black text-indigo-500 tracking-tighter uppercase">ATMOS</h1>
        <div id="date-time-display" class="text-[10px] text-gray-500 font-mono leading-tight"></div>
     </div>
     <div class="flex items-center gap-3">
        <div class="bg-gray-800 px-3 py-1.5 rounded-xl text-xs border border-gray-700">
            ×¢×•×‘×“: <span id="current-staff-name" class="font-bold text-indigo-400">×× ×”×œ</span>
            <button onclick="changeUser()" class="mr-2 text-indigo-300 underline underline-offset-2 hover:text-white transition-colors">×”×—×œ×£</button>
        </div>
     </div>
   </header>

   <nav class="bg-gray-900 px-4 py-2 flex gap-2 border-b border-gray-800 overflow-x-auto scrollbar-thin">
     <button onclick="switchTab('tables')" id="tab-tables" class="tab-btn tab-active px-5 py-2 rounded-xl text-sm font-bold transition-all whitespace-nowrap">ğŸª‘ ×©×•×œ×—× ×•×ª</button>
     <button onclick="switchTab('inventory')" id="tab-inventory" class="tab-btn bg-gray-800 px-5 py-2 rounded-xl text-sm font-bold text-gray-400 transition-all whitespace-nowrap">ğŸ“¦ ××œ××™</button>
     <button onclick="switchTab('analytics')" id="tab-analytics" class="tab-btn bg-gray-800 px-5 py-2 rounded-xl text-sm font-bold text-gray-400 transition-all whitespace-nowrap">ğŸ“ˆ ×× ×œ×™×˜×™×§×¡</button>
     <button onclick="switchTab('archive')" id="tab-archive" class="tab-btn bg-gray-800 px-5 py-2 rounded-xl text-sm font-bold text-gray-400 transition-all whitespace-nowrap">ğŸ—‚ï¸ ××¨×›×™×•×Ÿ</button>
   </nav>

   <main class="flex-1 p-4 overflow-y-auto scrollbar-thin">
    <div id="view-tables" class="view-content flex flex-col h-full">
     <div class="flex items-center justify-between mb-6">
      <h2 class="text-xl font-black text-gray-400 uppercase tracking-widest">Floor Map</h2>
      <button onclick="openAddTableModal()" class="bg-indigo-600 hover:bg-indigo-500 px-6 py-2.5 rounded-2xl font-black shadow-lg shadow-indigo-500/20 active:scale-95 transition-all">
       + ×©×•×œ×—×Ÿ ×—×“×©
      </button>
     </div>
     <div id="tables-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-10"></div>
     <div class="mt-auto pb-10 flex justify-center">
        <button onclick="closeShift()" class="bg-red-600 hover:bg-red-500 px-16 py-5 rounded-3xl font-black text-2xl shadow-2xl transition-all active:scale-90 border-b-4 border-red-800">
            ğŸ ×¡×’×™×¨×ª ××©××¨×ª
        </button>
     </div>
    </div>

    <div id="view-inventory" class="view-content hidden"><div id="inventory-grid" class="grid grid-cols-1 md:grid-cols-3 gap-4"></div></div>
    <div id="view-analytics" class="view-content hidden"><div id="analytics-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div></div>
    <div id="view-archive" class="view-content hidden"><div id="archive-list" class="space-y-4 max-w-3xl mx-auto"></div></div>
   </main>
  </div>

  <div id="modal-container" class="hidden fixed inset-0 z-50 modal-backdrop flex items-center justify-center p-4">
   <div id="modal-content" class="bg-gray-900 rounded-[2.5rem] max-w-lg w-full max-h-[90vh] overflow-y-auto border border-gray-800 p-8 shadow-2xl scrollbar-thin"></div>
  </div>

  <script>
    const STAGES = [{n:'×”×›× ×”', d:15*60}, {n:'×’×—×œ×™× 1', d:30*60}, {n:'×’×—×œ×™× 2', d:30*60}];
    
    const menuItems = [
      { id: 'f1', name: 'Pinkman', price: 85, category: '××•×¢×“×¤×™×' },
      { id: 'f2', name: 'Lemon Mint', price: 80, category: '××•×¢×“×¤×™×' },
      { id: 'f3', name: 'Ice Blueberry Mint', price: 80, category: '××•×¢×“×¤×™×' },
      { id: 'm1', name: 'Purple Skitlzz', price: 80, category: 'mono' },
      { id: 'm2', name: 'Tik Tak', price: 80, category: 'mono' },
      { id: 'm3', name: 'Peach Apricot', price: 80, category: 'mono' },
      { id: 'm4', name: 'Lychee Orange Strawberry', price: 80, category: 'mono' },
      { id: 'm5', name: 'Jumango', price: 80, category: 'mono' },
      { id: 'm6', name: 'Sour Sweet Raspberry', price: 80, category: 'mono' },
      { id: 'm7', name: 'Ice Sweet Mango', price: 80, category: 'mono' },
      { id: 'm8', name: 'Berries', price: 80, category: 'mono' },
      { id: 'm9', name: 'Ice', price: 80, category: 'mono' },
      { id: 'm10', name: 'Guava Energy Drink', price: 80, category: 'mono' },
      { id: 'm11', name: 'Island Mix', price: 80, category: 'mono' },
      { id: 'm12', name: 'Mono Mix', price: 80, category: 'mono' },
      { id: 'mb1', name: 'Grape', price: 85, category: 'mono black' },
      { id: 'mb2', name: 'Strawberry', price: 85, category: 'mono black' },
      { id: 'mb3', name: 'Peach', price: 85, category: 'mono black' },
      { id: 'mb4', name: 'Lychee', price: 85, category: 'mono black' },
      { id: 'ds1', name: 'Cosmo Flower', price: 90, category: 'dark side' },
      { id: 'ds2', name: 'Deep Blue Sea', price: 90, category: 'dark side' },
      { id: 'ds3', name: 'Falling Star', price: 90, category: 'dark side' },
      { id: 'ds4', name: 'Torpedo', price: 90, category: 'dark side' },
      { id: 'mh1', name: 'Nord Star', price: 90, category: 'musthave' },
      { id: 'mh3', name: 'Space Flavor', price: 90, category: 'musthave' },
      { id: 'mh4', name: 'Barberry Candy', price: 90, category: 'musthave' },
      { id: 'mh5', name: 'Must Have 60g â€“ Cola', price: 110, category: 'musthave' },
      { id: 'mh6', name: 'Must Have 60g â€“ Frosty', price: 110, category: 'musthave' },
      { id: 'mx1', name: 'chill%thrill', price: 95, category: '××™×§×¡×™×' },
      { id: 'mx2', name: 'frooty sunset', price: 95, category: '××™×§×¡×™×' },
      { id: 'mx3', name: 'skitzberry', price: 95, category: '××™×§×¡×™×' },
      { id: 'mx4', name: 'tropical charge', price: 95, category: '××™×§×¡×™×' },
      { id: 'mx5', name: 'peach breeze', price: 95, category: '××™×§×¡×™×' },
      { id: 'mx6', name: 'berry breeze', price: 95, category: '××™×§×¡×™×' }
    ];

    let tables = JSON.parse(localStorage.getItem('atmos_tables')) || [];
    let daily = JSON.parse(localStorage.getItem('atmos_daily')) || { rev:0, orders:0, cash:0, credit:0, flavors:{}, log:[], hours:{} };
    let archive = JSON.parse(localStorage.getItem('atmos_archive')) || [];
    let currentActiveTab = 'tables';

    function save() {
        localStorage.setItem('atmos_tables', JSON.stringify(tables));
        localStorage.setItem('atmos_daily', JSON.stringify(daily));
        localStorage.setItem('atmos_archive', JSON.stringify(archive));
    }

    function init() {
      render();
      setInterval(() => { 
          updateClock(); 
          if(currentActiveTab === 'tables') tick(); 
      }, 1000);
    }

    function render() {
      if(currentActiveTab === 'tables') renderTables();
      renderStats();
      renderArchive();
      renderInventory();
    }

    function renderTables() {
      const grid = document.getElementById('tables-grid');
      grid.innerHTML = '';
      tables.forEach(t => {
        const color = t.paid ? '#1e293b' : `hsl(${t.hue || 220}, 65%, 45%)`;
        const card = document.createElement('div');
        card.className = `table-card p-8 rounded-[2rem] flex flex-col items-center justify-center text-center cursor-pointer relative shadow-2xl transition-transform active:scale-95 ${t.paid ? 'opacity-40 grayscale-[0.5]' : ''}`;
        card.style.backgroundColor = color;
        card.onclick = () => openTableModal(t.id);
        card.innerHTML = `
            <div class="text-3xl font-black mb-2">${t.name}</div>
            <div class="text-[11px] font-bold bg-black/30 px-4 py-1.5 rounded-full uppercase tracking-wider">${getTimerText(t)}</div>
            <button onclick="event.stopPropagation(); deleteTable('${t.id}')" class="absolute top-4 left-4 text-white/20 hover:text-white transition-colors">âœ•</button>
        `;
        grid.appendChild(card);
      });
    }

    function getTimerText(t) {
      if (!t.start || t.paid) return '×¤× ×•×™';
      const s = t.stage || 0;
      if (s >= STAGES.length) return 'âœ… ××•×›×Ÿ ×œ×ª×©×œ×•×';
      const rem = Math.max(0, STAGES[s].d - Math.floor((Date.now() - t.start) / 1000));
      const m = Math.floor(rem/60), sec = rem%60;
      return `${STAGES[s].n}: ${m}:${sec < 10 ? '0'+sec : sec}`;
    }

    function tick() {
      let changed = false;
      tables.forEach(t => {
        if (t.start && !t.paid) {
          const s = t.stage || 0;
          if (Math.floor((Date.now() - t.start) / 1000) >= STAGES[s].d && s < STAGES.length) {
            t.stage = s + 1; t.start = Date.now();
            changed = true;
          }
        }
      });
      if (changed) {
          save();
          renderTables();
      } else {
          // ×¢×“×›×•×Ÿ ×˜×§×¡×˜×•××œ×™ ×‘×œ×‘×“ ×œ×× ×™×¢×ª ×”×‘×”×•×‘
          document.querySelectorAll('.table-card').forEach((card, idx) => {
              if(tables[idx]) {
                  const timerEl = card.querySelector('div:nth-child(2)');
                  if(timerEl) timerEl.innerHTML = getTimerText(tables[idx]);
              }
          });
      }
    }

    function openTableModal(id) {
      const t = tables.find(x => x.id === id);
      if (!t) return;
      const total = (t.items || []).reduce((a,b) => a + (b.price * b.qty), 0);
      const modal = document.getElementById('modal-content');
      const cats = ['××•×¢×“×¤×™×', 'mono', 'mono black', 'dark side', 'musthave', '××™×§×¡×™×'];

      modal.innerHTML = `
        <div class="flex justify-between items-center mb-8">
            <h2 class="text-3xl font-black text-white">${t.name}</h2>
            <button onclick="closeModal()" class="bg-gray-800 p-2 rounded-full text-gray-400">âœ•</button>
        </div>
        ${t.start && !t.paid ? `
            <div class="bg-gray-800/50 p-5 rounded-3xl mb-8 flex justify-between items-center border border-gray-700 shadow-inner">
                <div class="font-black text-indigo-400 text-lg">${getTimerText(t)}</div>
                <div class="flex gap-2">
                    <button onclick="skipTimer('${id}')" class="bg-indigo-600/20 text-indigo-400 px-4 py-2 rounded-xl text-[10px] font-black border border-indigo-500/30 tracking-tighter whitespace-nowrap">×“×œ×’ â”</button>
                    <button onclick="openPaymentModal('${id}')" class="bg-green-600/20 text-green-400 px-4 py-2 rounded-xl text-[10px] font-black border border-green-500/30 tracking-tighter whitespace-nowrap">×ª×©×œ×•× ğŸ’°</button>
                </div>
            </div>` : ''}
        <div class="mb-8">
            <h3 class="text-[10px] font-black text-gray-500 uppercase tracking-widest mb-3">Order Status (â‚ª${total})</h3>
            <div class="max-h-40 overflow-y-auto space-y-2 pr-2 scrollbar-thin">
                ${(t.items || []).length > 0 ? t.items.map(i => `<div class="flex justify-between bg-gray-800 p-3 rounded-2xl border border-gray-700 text-sm"><span>${i.name} <b class="text-indigo-400">x${i.qty}</b></span><button onclick="removeItem('${t.id}','${i.id}')" class="text-red-500 font-bold">××—×§</button></div>`).join('') : '<div class="text-gray-600 italic text-xs">××™×Ÿ ×¤×¨×™×˜×™×</div>'}
            </div>
        </div>
        <div class="mb-6 h-60 overflow-y-auto border-t border-gray-800 pt-4 scrollbar-thin">
            ${cats.map(cat => `
                <div class="category-label">${cat}</div>
                <div class="grid grid-cols-2 gap-2 mb-4">
                    ${menuItems.filter(m => m.category === cat).map(i => `
                        <button onclick="addItem('${t.id}','${i.id}')" class="bg-gray-800 hover:bg-gray-700 p-4 rounded-2xl text-right text-[12px] font-bold border border-gray-700 transition-colors">${i.name}</button>
                    `).join('')}
                </div>
            `).join('')}
        </div>
        <div class="mt-4">
            ${!t.start && !t.paid ? `<button onclick="startOrder('${t.id}')" class="w-full bg-indigo-600 py-5 rounded-[1.5rem] font-black text-xl shadow-xl active:scale-95 transition-all">×”×›× ×¡×ª ×”×–×× ×”</button>` : 
            t.paid ? `<button onclick="deleteTable('${t.id}')" class="w-full bg-red-600/20 text-red-500 py-5 rounded-2xl font-black">××—×§ ××”××¡×š</button>` :
            `<button onclick="openPaymentModal('${t.id}')" class="w-full bg-green-600 py-5 rounded-[1.5rem] font-black text-xl shadow-xl active:scale-95 transition-all">×œ×ª×©×œ×•×</button>`}
        </div>
      `;
      document.getElementById('modal-container').classList.remove('hidden');
    }

    function openPaymentModal(id) {
        const t = tables.find(x => x.id === id);
        const total = (t.items || []).reduce((a,b) => a + (b.price * b.qty), 0);
        const modal = document.getElementById('modal-content');
        modal.innerHTML = `
            <div class="text-center">
                <div class="text-6xl font-black mb-10 text-indigo-400 tracking-tighter">â‚ª${total}</div>
                <div class="mb-8 text-right px-4">
                    <label class="text-[10px] text-gray-500 font-bold mr-2 uppercase">×¡×›×•× ×©×©×•×œ×:</label>
                    <input type="number" id="pay-amt" value="${total}" class="w-full bg-gray-800 border-2 border-gray-700 rounded-3xl p-5 text-center text-3xl font-black outline-none focus:border-indigo-500 mt-2">
                </div>
                <div class="grid grid-cols-2 gap-4 mb-8">
                    <button onclick="finishPay('${id}','cash')" class="bg-gray-800 hover:bg-gray-700 p-8 rounded-[2rem] font-black border-2 border-gray-700 text-xl">ğŸ’µ ××–×•××Ÿ</button>
                    <button onclick="finishPay('${id}','credit')" class="bg-gray-800 hover:bg-gray-700 p-8 rounded-[2rem] font-black border-2 border-gray-700 text-xl">ğŸ’³ ××©×¨××™</button>
                </div>
                <button onclick="openTableModal('${id}')" class="text-gray-600 font-bold hover:text-white">×—×–×•×¨ ×œ×¢×¨×™×›×”</button>
            </div>
        `;
    }

    function startOrder(id) {
        const t = tables.find(x => x.id === id);
        if (!t) return;
        t.start = Date.now(); t.stage = 0;
        const hour = new Date().getHours();
        daily.hours[hour] = (daily.hours[hour] || 0) + 1;
        save(); closeModal(); render();
    }

    function finishPay(id, method) {
        const t = tables.find(x => x.id === id);
        const total = (t.items || []).reduce((a,b) => a + (b.price * b.qty), 0);
        t.paid = true; t.start = null;
        daily.rev += total; daily.orders++;
        if(method === 'cash') daily.cash += total; else daily.credit += total;
        daily.log.push({ t:t.name, m:method, a:total, time: new Date().toLocaleTimeString('he-IL') });
        (t.items || []).forEach(i => daily.flavors[i.name] = (daily.flavors[i.name] || 0) + i.qty);
        save(); closeModal(); render();
    }

    function closeShift() {
        if(!confirm("×¡×’×™×¨×ª ××©××¨×ª? ×”× ×ª×•× ×™× ×™×¢×‘×¨×• ×œ××¨×›×™×•×Ÿ ×•×”××¡×š ×™×ª××¤×¡.")) return;
        archive.push({ 
            date: new Date().toLocaleDateString('he-IL'), 
            time: new Date().toLocaleTimeString('he-IL'),
            id: Date.now(),
            daily: JSON.parse(JSON.stringify(daily)), 
            tables: tables.filter(t=>t.paid) 
        });
        tables = [];
        daily = { rev:0, orders:0, cash:0, credit:0, flavors:{}, log:[], hours:{} };
        save();
        location.reload();
    }

    function openAddTableModal() {
        const modal = document.getElementById('modal-content');
        modal.innerHTML = `
            <div class="text-center">
                <h2 class="text-2xl font-black mb-8 uppercase tracking-tighter">×¤×ª×— ×©×•×œ×—×Ÿ</h2>
                <input type="text" id="new-name" placeholder="×©×/××¡×¤×¨" class="w-full bg-gray-800 border-2 border-gray-700 rounded-3xl p-6 text-center text-3xl font-black mb-8 outline-none focus:border-indigo-500">
                <button onclick="addTable()" class="w-full bg-indigo-600 py-5 rounded-[1.5rem] font-black text-xl active:scale-95 transition-all">××™×©×•×¨</button>
            </div>
        `;
        document.getElementById('modal-container').classList.remove('hidden');
        document.getElementById('new-name').focus();
    }

    function addTable() {
        const n = document.getElementById('new-name').value;
        if(!n) return;
        const id = 't' + Date.now();
        tables.push({ id, name: n, hue: Math.floor(Math.random()*360), items: [], paid: false, stage: 0, start: null });
        save(); 
        openTableModal(id);
    }

    function renderStats() {
        const grid = document.getElementById('analytics-grid');
        if(!grid) return;
        const peakHour = Object.entries(daily.hours).sort((a,b)=>b[1]-a[1])[0];
        grid.innerHTML = `
            <div class="bg-gray-800 p-8 rounded-[2.5rem] border border-gray-700">
                <h3 class="text-indigo-400 font-black mb-6 uppercase tracking-widest text-xs">ğŸ† ×˜×¢××™× ××•×‘×™×œ×™×</h3>
                ${Object.entries(daily.flavors).sort((a,b)=>b[1]-a[1]).slice(0,5).map(([n,q])=>`<div class="flex justify-between text-sm py-2 border-b border-gray-700/50"><span>${n}</span><b class="text-indigo-400">${q}</b></div>`).join('')}
            </div>
            <div class="bg-gray-800 p-8 rounded-[2.5rem] border border-gray-700">
                <h3 class="text-indigo-400 font-black mb-6 uppercase tracking-widest text-xs">â° ×©×¢×•×ª ×©×™×</h3>
                <div class="text-3xl font-black text-center py-4">${peakHour ? peakHour[0] + ':00' : '--:--'}<div class="text-[10px] text-gray-500 mt-1 uppercase font-bold">${peakHour ? peakHour[1] + ' ×”×–×× ×•×ª' : '××™×Ÿ × ×ª×•× ×™×'}</div></div>
            </div>
            <div class="bg-gray-800 p-8 rounded-[2.5rem] border border-gray-700 md:col-span-2">
                <h3 class="text-indigo-400 font-black mb-6 uppercase tracking-widest text-xs">ğŸ’° ×¤×™×¨×•×˜ ×”×›× ×¡×•×ª</h3>
                <div class="flex justify-around mb-6 bg-gray-900 p-4 rounded-2xl">
                    <div><div class="text-[10px] text-gray-500 font-bold">××–×•××Ÿ</div><b class="text-green-400 text-lg">â‚ª${daily.cash}</b></div>
                    <div><div class="text-[10px] text-gray-500 font-bold">××©×¨××™</div><b class="text-blue-400 text-lg">â‚ª${daily.credit}</b></div>
                </div>
            </div>
        `;
    }

    function renderArchive() {
        const list = document.getElementById('archive-list');
        if(!list) return;
        list.innerHTML = archive.slice().reverse().map(s => {
            const peak = Object.entries(s.daily.hours || {}).sort((a,b)=>b[1]-a[1])[0];
            return `
            <div class="bg-gray-800 rounded-[2rem] border border-gray-700 overflow-hidden shadow-lg">
                <div class="bg-gray-900 px-6 py-4 flex justify-between items-center cursor-pointer" onclick="toggleArchiveDetail(event, '${s.id}')">
                    <span class="font-black text-indigo-300 ml-3">${s.date}</span>
                    <div class="flex items-center gap-4">
                        <span class="text-xl font-black text-green-400 tracking-tighter">â‚ª${s.daily.rev}</span>
                        <button onclick="event.stopPropagation(); deleteArchive('${s.id}')" class="text-red-900 hover:text-red-500">âœ•</button>
                    </div>
                </div>
                <div id="detail-${s.id}" class="hidden p-6 border-t border-gray-800 grid grid-cols-2 md:grid-cols-4 gap-4 text-[10px]">
                    <div><b class="block text-indigo-400 mb-1 uppercase tracking-widest text-[9px]">×ª×©×œ×•×:</b> ××–×•××Ÿ: â‚ª${s.daily.cash}<br>××©×¨××™: â‚ª${s.daily.credit}</div>
                    <div><b class="block text-indigo-400 mb-1 uppercase tracking-widest text-[9px]">×©×¢×ª ×©×™×:</b> ${peak ? peak[0]+':00 ('+peak[1]+')' : '--'}</div>
                    <div class="col-span-2"><b class="block text-indigo-400 mb-1 uppercase tracking-widest text-[9px]">× ××›×¨×•:</b> ${Object.entries(s.daily.flavors || {}).map(f => f[0] + ' ('+f[1]+')').join(', ')}</div>
                </div>
            </div>`}).join('');
    }

    function toggleArchiveDetail(event, id) {
        event.preventDefault();
        const el = document.getElementById('detail-' + id);
        if(el) {
            const isHidden = el.classList.contains('hidden');
            // ×¡×’×™×¨×ª ×›×œ ×©××¨ ×”×œ×©×•× ×™×•×ª (××•×¤×¦×™×•× ×œ×™)
            document.querySelectorAll('[id^="detail-"]').forEach(d => d.classList.add('hidden'));
            if(isHidden) el.classList.remove('hidden');
        }
    }

    function deleteArchive(id) { if(confirm("××—×™×§×ª ×¡×™×›×•× ××©××¨×ª ××”××¨×›×™×•×Ÿ?")) { archive = archive.filter(x => x.id != id); save(); renderArchive(); } }
    function skipTimer(id) { const t = tables.find(x => x.id === id); if(t) { t.stage++; t.start = Date.now(); save(); openTableModal(id); } }
    function addItem(tid, mid) { 
        const t = tables.find(x => x.id === tid), m = menuItems.find(x => x.id === mid);
        if(!t) return;
        const ex = t.items.find(x => x.id === mid);
        if(ex) ex.qty++; else t.items.push({...m, qty:1});
        save(); openTableModal(tid);
    }
    function removeItem(tid, mid) { const t = tables.find(x => x.id === tid); if(t) { t.items = t.items.filter(x => x.id !== mid); save(); openTableModal(tid); } }
    function deleteTable(id) { if(confirm("×œ××—×•×§ ×©×•×œ×—×Ÿ?")) { tables = tables.filter(x => x.id !== id); save(); renderTables(); } }
    function switchTab(id) {
        currentActiveTab = id;
        document.querySelectorAll('.view-content').forEach(v => v.classList.add('hidden'));
        document.getElementById('view-'+id).classList.remove('hidden');
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('tab-active', 'text-white'));
        document.getElementById('tab-'+id).classList.add('tab-active');
        render();
    }
    function closeModal() { document.getElementById('modal-container').classList.add('hidden'); }
    function updateClock() { 
        const now = new Date(); 
        const dateStr = now.toLocaleDateString('he-IL', { day: '2-digit', month: '2-digit', year: '2-digit' });
        document.getElementById('date-time-display').innerHTML = `${now.toLocaleTimeString('he-IL', {hour:'2-digit', minute:'2-digit'})}<br>${dateStr}`; 
    }
    function changeUser() { const u = prompt("×©× ×¢×•×‘×“:"); if(u) { document.getElementById('current-staff-name').textContent = u; localStorage.setItem('atmos_staff', u); } }
    function renderInventory() { 
        const grid = document.getElementById('inventory-grid');
        if(grid) grid.innerHTML = menuItems.map(i => `<div class="bg-gray-800 p-4 rounded-2xl border border-gray-700 flex justify-between items-center"><div class="text-[11px] font-bold text-gray-300">${i.name}</div><div class="text-[9px] text-indigo-500 font-bold uppercase">${i.category}</div></div>`).join(''); 
    }

    const savedStaff = localStorage.getItem('atmos_staff');
    if(savedStaff) document.getElementById('current-staff-name').textContent = savedStaff;

    init();
  </script>
 </body>
</html>
