<!doctype html>
<html lang="he" dir="rtl" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ATMOS - Management Console</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;500;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
    :root { --glass: rgba(255, 255, 255, 0.08); --glass-border: rgba(255, 255, 255, 0.15); }
    body { box-sizing: border-box; font-family: 'Assistant', sans-serif; background: radial-gradient(circle at top left, #1e1b4b, #0f172a, #000); color: white; margin: 0; overflow: hidden; }
    .glass { background: var(--glass); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px); border: 1px solid var(--glass-border); border-radius: 28px; }
    .ios-btn { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid var(--glass-border); transition: all 0.2s ease; cursor: pointer; }
    .ios-btn:active { transform: scale(0.95); background: rgba(255, 255, 255, 0.2); }
    .tab-active { background: white !important; color: black !important; font-weight: 800; box-shadow: 0 8px 32px rgba(255,255,255,0.1); }
    .table-card { transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); backface-visibility: hidden; }
    .timer-warning { animation: pulse 1s infinite; background: rgba(239, 68, 68, 0.5) !important; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
    .scrollbar-thin::-webkit-scrollbar { width: 4px; }
    .scrollbar-thin::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }
    .category-label { border-right: 3px solid #6366f1; padding-right: 8px; margin: 15px 0 8px 0; font-weight: 800; font-size: 0.75rem; color: #a5b4fc; text-transform: uppercase; }
  </style>
 </head>
 <body class="h-full">
  <div id="app" class="h-full flex flex-col p-4 md:p-6 gap-4 text-right">
   
   <header class="glass p-5 flex items-center justify-between shadow-2xl">
     <div>
        <h1 class="text-2xl font-black tracking-tighter italic">ATMOS <span class="font-thin text-gray-400 text-sm">SYSTEM</span></h1>
        <div id="date-time-display" class="text-[10px] text-gray-500 font-bold mt-1 uppercase tracking-widest"></div>
     </div>
     <div class="glass px-4 py-2 text-xs flex items-center gap-2">
        <span id="current-staff-name" class="font-black text-indigo-400">×× ×”×œ</span>
        <button onclick="changeUser()" class="opacity-50 hover:opacity-100 italic mr-1">×”×—×œ×£</button>
     </div>
   </header>

   <nav class="glass p-1.5 flex gap-1">
     <button onclick="switchTab('tables')" id="tab-tables" class="tab-btn tab-active flex-1 py-3 rounded-[20px] text-xs font-black">×©×•×œ×—× ×•×ª</button>
     <button onclick="switchTab('expenses')" id="tab-expenses" class="tab-btn flex-1 py-3 rounded-[20px] text-xs font-black text-gray-400">×”×•×¦××•×ª</button>
     <button onclick="switchTab('analytics')" id="tab-analytics" class="tab-btn flex-1 py-3 rounded-[20px] text-xs font-black text-gray-400">×× ×œ×™×˜×™×§×¡</button>
     <button onclick="switchTab('archive')" id="tab-archive" class="tab-btn flex-1 py-3 rounded-[20px] text-xs font-black text-gray-400">××¨×›×™×•×Ÿ</button>
   </nav>

   <main class="flex-1 overflow-y-auto scrollbar-thin rounded-[32px]">
    
    <div id="view-tables" class="view-content flex flex-col h-full">
        <div class="flex justify-between items-center mb-6 px-2">
            <h2 class="text-[10px] font-black text-gray-500 uppercase tracking-widest">Active Floor</h2>
            <button onclick="openAddTableModal()" class="bg-white text-black px-6 py-2 rounded-full font-black text-xs shadow-xl active:scale-95 transition-all">+ ×©×•×œ×—×Ÿ</button>
        </div>
        <div id="active-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4"></div>

        <div id="closed-section" class="hidden mt-12">
            <div class="flex items-center gap-4 mb-6 px-2">
                <span class="h-px flex-1 bg-white/10"></span>
                <h2 class="text-[10px] font-black text-gray-600 uppercase tracking-widest whitespace-nowrap">×©×•×œ×—× ×•×ª ×©× ×¡×’×¨×•</h2>
                <span class="h-px flex-1 bg-white/10"></span>
            </div>
            <div id="closed-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 opacity-60"></div>
        </div>

        <div class="mt-auto pt-10 pb-4 flex justify-center">
            <button onclick="closeShift()" class="ios-btn px-16 py-5 rounded-[32px] font-black text-xl text-red-400 border-red-500/20 shadow-2xl active:scale-95 transition-all">ğŸ ×¡×’×™×¨×ª ××©××¨×ª</button>
        </div>
    </div>

    <div id="view-expenses" class="view-content hidden p-2">
        <div class="glass p-8 max-w-xl mx-auto">
            <h2 class="text-xl font-bold mb-6 text-indigo-400">× ×™×”×•×œ ×”×•×¦××•×ª</h2>
            <div class="flex gap-2 mb-8">
                <input type="text" id="exp-desc" placeholder="×ª×™××•×¨" class="flex-1 glass bg-transparent rounded-2xl p-4 outline-none border-white/10">
                <input type="number" id="exp-amt" placeholder="â‚ª" class="w-24 glass bg-transparent rounded-2xl p-4 outline-none text-center border-white/10">
                <button onclick="addExpense()" class="bg-indigo-600 px-6 rounded-2xl font-bold active:scale-95">×”×•×¡×£</button>
            </div>
            <div id="expenses-list" class="space-y-3"></div>
        </div>
    </div>

    <div id="view-analytics" class="view-content hidden p-2 space-y-4">
        <div id="analytics-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-5xl mx-auto"></div>
    </div>

    <div id="view-archive" class="view-content hidden p-2 space-y-4">
        <h2 class="text-xl font-black text-white mb-4 px-2 tracking-tighter">××¨×›×™×•×Ÿ ×¡×™×›×•××™ ×™×•×</h2>
        <div id="archive-list" class="space-y-4 max-w-4xl mx-auto pb-10"></div>
    </div>

   </main>
  </div>

  <div id="modal-container" class="hidden fixed inset-0 z-50 modal-backdrop flex items-end md:items-center justify-center p-0 md:p-4" onclick="if(event.target === this) closeModal()">
   <div id="modal-content" class="bg-black/90 backdrop-blur-3xl w-full max-w-lg rounded-t-[40px] md:rounded-[40px] max-h-[92vh] overflow-y-auto border-t md:border border-white/10 p-8 shadow-2xl scrollbar-thin text-right" onclick="event.stopPropagation()"></div>
  </div>

  <script>
    const STAGES = [{n:'×”×›× ×”', d:15*60}, {n:'×’×—×œ×™× 1', d:30*60}, {n:'×’×—×œ×™× 2', d:30*60}];
    
    const menuItems = [
      { id: 'mx1', name: 'chill%thrill', price: 95, category: '××™×§×¡×™×' },
      { id: 'mx2', name: 'frooty sunset', price: 95, category: '××™×§×¡×™×' },
      { id: 'mx3', name: 'skitzberry', price: 95, category: '××™×§×¡×™×' },
      { id: 'mx4', name: 'tropical charge', price: 95, category: '××™×§×¡×™×' },
      { id: 'mx5', name: 'peach breeze', price: 95, category: '××™×§×¡×™×' },
      { id: 'mx6', name: 'berry breeze', price: 95, category: '××™×§×¡×™×' },
      { id: 'f1', name: 'Pinkman', price: 85, category: '××•×¢×“×¤×™×' },
      { id: 'f2', name: 'Lemon Mint', price: 80, category: '××•×¢×“×¤×™×' },
      { id: 'f3', name: 'Ice Blueberry Mint', price: 80, category: '××•×¢×“×¤×™×' },
      { id: 'm1', name: 'Purple Skitlzz', price: 80, category: 'mono' },
      { id: 'm2', name: 'Tik Tak', price: 80, category: 'mono' },
      { id: 'm3', name: 'Peach Apricot', price: 80, category: 'mono' },
      { id: 'm4', name: 'Lychee Orange Strawberry', price: 80, category: 'mono' },
      { id: 'm5', name: 'Jumango', price: 80, category: 'mono' },
      { id: 'm6', name: 'Sour Sweet Raspberry', price: 80, category: 'mono' },
      { id: 'm7', name: 'Ice Sweet Mango', price: 80, category: 'mono' },
      { id: 'm8', name: 'Berries', price: 80, category: 'mono' },
      { id: 'm9', name: 'Ice', price: 80, category: 'mono' },
      { id: 'm10', name: 'Guava Energy Drink', price: 80, category: 'mono' },
      { id: 'm11', name: 'Island Mix', price: 80, category: 'mono' },
      { id: 'm12', name: 'Mono Mix', price: 80, category: 'mono' },
      { id: 'mb1', name: 'Grape', price: 85, category: 'mono black' },
      { id: 'mb2', name: 'Strawberry', price: 85, category: 'mono black' },
      { id: 'mb3', name: 'Peach', price: 85, category: 'mono black' },
      { id: 'mb4', name: 'Lychee', price: 85, category: 'mono black' },
      { id: 'ds1', name: 'Cosmo Flower', price: 90, category: 'dark side' },
      { id: 'ds2', name: 'Deep Blue Sea', price: 90, category: 'dark side' },
      { id: 'ds3', name: 'Falling Star', price: 90, category: 'dark side' },
      { id: 'ds4', name: 'Torpedo', price: 90, category: 'dark side' },
      { id: 'mh1', name: 'Nord Star', price: 90, category: 'musthave' },
      { id: 'mh3', name: 'Space Flavor', price: 90, category: 'musthave' },
      { id: 'mh4', name: 'Barberry Candy', price: 90, category: 'musthave' },
      { id: 'mh5', name: 'Must Have 60g â€“ Cola', price: 110, category: 'musthave' },
      { id: 'mh6', name: 'Must Have 60g â€“ Frosty', price: 110, category: 'musthave' }
    ];

    let tables = JSON.parse(localStorage.getItem('atmos_tables')) || [];
    let daily = JSON.parse(localStorage.getItem('atmos_daily')) || { rev:0, orders:0, cash:0, credit:0, tips:0, flavors:{}, expenses:[], hours:{} };
    let archive = JSON.parse(localStorage.getItem('atmos_archive')) || [];
    let currentTab = 'tables';

    function save() { 
        localStorage.setItem('atmos_tables', JSON.stringify(tables)); 
        localStorage.setItem('atmos_daily', JSON.stringify(daily));
        localStorage.setItem('atmos_archive', JSON.stringify(archive));
    }

    function init() {
      const savedStaff = localStorage.getItem('atmos_staff');
      if(savedStaff) document.getElementById('current-staff-name').textContent = savedStaff;
      render();
      setInterval(() => { updateClock(); if(currentTab === 'tables') tick(); }, 1000);
    }

    function render() {
      if(currentTab === 'tables') {
          const activeGrid = document.getElementById('active-grid');
          const closedGrid = document.getElementById('closed-grid');
          const closedSection = document.getElementById('closed-section');
          
          activeGrid.innerHTML = ''; closedGrid.innerHTML = '';
          let closedCount = 0;

          tables.forEach(t => {
            const card = document.createElement('div');
            const color = t.paid ? 'rgba(30, 41, 59, 0.8)' : `hsla(${t.hue}, 75%, 45%, 0.85)`;
            card.className = `table-card glass p-6 flex flex-col items-center justify-center text-center cursor-pointer shadow-2xl ${t.paid ? 'grayscale opacity-50' : ''}`;
            card.style.backgroundColor = color;
            card.onclick = () => t.paid ? null : openTableModal(t.id);
            
            card.innerHTML = `
                <div class="text-3xl font-black mb-1">${t.name}</div>
                <div class="text-[9px] opacity-60 mb-2 font-bold uppercase tracking-tighter">${t.staff}</div>
                <div class="text-[11px] font-black bg-black/30 px-4 py-1.5 rounded-full mb-4 ${getTimerWarning(t)}">${getTimerText(t)}</div>
                ${!t.paid && t.start ? `
                    <div class="grid grid-cols-2 gap-2 w-full mt-2">
                        <button onclick="event.stopPropagation(); skipTimer('${t.id}')" class="ios-btn py-3 rounded-2xl text-[9px] font-black uppercase">×“×œ×’ â”</button>
                        <button onclick="event.stopPropagation(); openPaymentModal('${t.id}')" class="ios-btn py-3 rounded-2xl text-[9px] font-black uppercase text-green-400">×ª×©×œ×•× ğŸ’°</button>
                    </div>
                ` : ''}
                <button onclick="event.stopPropagation(); deleteTable('${t.id}')" class="absolute top-3 left-3 text-white/10 hover:text-white">âœ•</button>
            `;

            if (t.paid) { closedGrid.appendChild(card); closedCount++; }
            else { activeGrid.appendChild(card); }
          });
          closedSection.style.display = closedCount > 0 ? 'block' : 'none';
      }
      renderStats();
      renderArchive();
      renderExpenses();
    }

    function tick() {
      let changed = false;
      tables.forEach(t => {
        if (t.start && !t.paid) {
          const s = t.stage || 0;
          const elapsed = Math.floor((Date.now() - t.start) / 1000);
          if (elapsed >= STAGES[s].d && s < STAGES.length - 1) {
            t.stage = s + 1; t.start = Date.now();
            changed = true;
          }
        }
      });
      if (changed) save();
      
      // Update DOM for timers only to prevent flicker
      document.querySelectorAll('.table-card').forEach(card => {
          const name = card.querySelector('.text-3xl').innerText;
          const t = tables.find(x => x.name === name);
          if(t) {
              const timerDiv = card.querySelector('div:nth-child(3)');
              timerDiv.innerHTML = getTimerText(t);
              timerDiv.className = `text-[11px] font-bold bg-black/30 px-4 py-1.5 rounded-full mb-4 ${getTimerWarning(t)}`;
          }
      });
    }

    function getTimerText(t) {
      if (t.paid) return '×©×•×œ×';
      if (!t.start) return '×¤× ×•×™';
      const s = t.stage || 0;
      const elapsed = Math.floor((Date.now() - t.start) / 1000);
      if (s >= STAGES.length - 1 && elapsed >= STAGES[s].d) return 'âœ… ××•×›×Ÿ ×œ×ª×©×œ×•×';
      const rem = Math.max(0, STAGES[s].d - elapsed);
      return `${STAGES[s].n}: ${Math.floor(rem/60)}:${(rem%60).toString().padStart(2, '0')}`;
    }

    function getTimerWarning(t) {
        if (!t.start || t.paid) return '';
        const s = t.stage || 0;
        const rem = STAGES[s].d - Math.floor((Date.now() - t.start) / 1000);
        return rem < 60 && rem > 0 ? 'timer-warning' : '';
    }

    function openTableModal(id) {
      const t = tables.find(x => x.id === id);
      if(!t) return;
      const total = (t.items || []).reduce((a,b) => a + (b.price * b.qty), 0);
      const modal = document.getElementById('modal-content');
      const cats = ['××™×§×¡×™×', '××•×¢×“×¤×™×', 'mono', 'dark side', 'musthave'];

      modal.innerHTML = `
        <div class="flex justify-between items-center mb-8">
            <h2 class="text-4xl font-black text-white">${t.name}</h2>
            <button onclick="closeModal()" class="ios-btn p-3 rounded-full text-gray-500">âœ•</button>
        </div>
        <div class="mb-8">
            <h3 class="text-[10px] font-black text-gray-500 uppercase tracking-widest mb-3">Items (â‚ª${total})</h3>
            <div class="space-y-2 max-h-32 overflow-y-auto pr-2 scrollbar-thin text-xs">
                ${(t.items || []).map(i => `<div class="glass p-4 flex justify-between items-center font-bold"><span>${i.name} <b>x${i.qty}</b></span><button onclick="removeItem('${t.id}','${i.id}')" class="text-red-500 font-bold uppercase text-[9px]">××—×§</button></div>`).join('')}
            </div>
        </div>
        <textarea id="order-notes" placeholder="×”×¢×¨×•×ª ×œ×”×–×× ×”..." class="w-full glass bg-transparent rounded-2xl p-4 text-xs h-20 outline-none border-white/5 mt-2 mb-6" onchange="updateNotes('${t.id}', this.value)">${t.notes || ''}</textarea>
        <div class="mb-8 h-60 overflow-y-auto border-t border-white/5 pt-4 scrollbar-thin text-right text-xs">
            ${cats.map(c => `
                <div class="category-label">${c}</div>
                <div class="grid grid-cols-2 gap-2 mb-4">
                    ${menuItems.filter(m => m.category === c).map(i => `<button onclick="addItem('${t.id}','${i.id}')" class="ios-btn p-4 rounded-2xl text-right font-bold">${i.name}</button>`).join('')}
                </div>
            `).join('')}
        </div>
        <div class="mt-4 grid grid-cols-1 gap-2">
            ${!t.start ? `<button onclick="startOrder('${t.id}')" class="w-full bg-indigo-600 py-5 rounded-[1.5rem] font-black text-xl shadow-xl active:scale-95 transition-all uppercase tracking-widest">×”×›× ×¡×ª ×”×–×× ×”</button>` : 
            `<button onclick="openPaymentModal('${t.id}')" class="w-full bg-white text-black py-5 rounded-[1.5rem] font-black text-xl shadow-xl active:scale-95 transition-all">×œ×ª×©×œ×•×</button>`}
        </div>
      `;
      document.getElementById('modal-container').classList.remove('hidden');
    }

    function openPaymentModal(id) {
        const t = tables.find(x => x.id === id);
        const total = (t.items || []).reduce((a,b) => a + (b.price * b.qty), 0);
        const modal = document.getElementById('modal-content');
        modal.innerHTML = `
            <div class="text-center">
                <div class="text-6xl font-black mb-10 text-indigo-400">â‚ª${total}</div>
                <div class="grid grid-cols-2 gap-4 mb-8 text-right px-4 text-xs font-bold">
                    <div><label class="block mb-2 text-gray-500">×¡×›×•×:</label><input type="number" id="pay-amt" value="${total}" class="w-full glass bg-transparent rounded-2xl p-5 text-center text-2xl font-black outline-none border-white/10 focus:border-white"></div>
                    <div><label class="block mb-2 text-green-400 uppercase tracking-widest">×˜×™×¤:</label><input type="number" id="pay-tip" value="0" class="w-full glass bg-transparent rounded-2xl p-5 text-center text-2xl font-black outline-none border-white/10 focus:border-green-500 text-green-400"></div>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-8">
                    <button onclick="window.payMethod='cash'; finishPay('${id}')" class="glass p-12 rounded-[2.5rem] font-black text-xl hover:bg-white/5 active:scale-95 transition-all">ğŸ’µ ××–×•××Ÿ</button>
                    <button onclick="window.payMethod='credit'; finishPay('${id}')" class="glass p-12 rounded-[2.5rem] font-black text-xl hover:bg-white/5 active:scale-95 transition-all">ğŸ’³ ××©×¨××™</button>
                </div>
                <button onclick="openTableModal('${id}')" class="text-gray-600 font-bold hover:text-white underline">×‘×™×˜×•×œ</button>
            </div>
        `;
        document.getElementById('modal-container').classList.remove('hidden');
    }

    function finishPay(id) {
        const t = tables.find(x => x.id === id);
        const method = window.payMethod;
        const amt = parseFloat(document.getElementById('pay-amt').value);
        const tip = parseFloat(document.getElementById('pay-tip').value);
        
        t.paid = true;
        t.timer_start_time = null;
        
        daily.rev += amt;
        daily.tips += tip;
        daily.orders++;
        if(method === 'cash') daily.cash += amt; else daily.credit += amt;
        
        save(); closeModal(); render();
    }

    function closeShift() {
        if(!confirm("×¡×’×™×¨×ª ××©××¨×ª ×ª×¢×‘×™×¨ ××ª ×”× ×ª×•× ×™× ×œ××¨×›×™×•×Ÿ ×•×ª× ×§×” ××ª ×”××¡×š. ×”××©×š?")) return;
        
        const peakHour = Object.entries(daily.hours).sort((a,b) => b[1]-a[1])[0];
        const shiftRecord = {
            id: Date.now(),
            date: new Date().toLocaleDateString('he-IL'),
            daily: JSON.parse(JSON.stringify(daily)),
            peak: peakHour ? peakHour[0] + ':00' : '--',
            staff: document.getElementById('current-staff-name').textContent
        };
        
        archive.push(shiftRecord);
        tables = [];
        daily = { rev:0, orders:0, cash:0, credit:0, tips:0, flavors:{}, expenses:[], hours:{} };
        
        save();
        location.reload();
    }

    function renderArchive() {
        const list = document.getElementById('archive-list');
        if(!list) return;
        list.innerHTML = archive.slice().reverse().map(s => `
            <div class="glass overflow-hidden mb-4 shadow-xl">
                <div class="p-6 flex justify-between items-center cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">
                    <span class="text-lg font-black text-indigo-300">ğŸ“… ${s.date}</span>
                    <div class="flex items-center gap-6">
                        <span class="text-2xl font-black text-green-400 tracking-tighter">â‚ª${s.daily.rev}</span>
                        <button onclick="event.stopPropagation(); deleteArchiveEntry('${s.id}')" class="text-red-900/50 hover:text-red-500 p-2">âœ•</button>
                    </div>
                </div>
                <div class="hidden p-8 border-t border-white/5 space-y-6 bg-white/5 text-right">
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center font-bold text-xs uppercase">
                        <div class="glass p-4 text-blue-400 tracking-widest">CARD: â‚ª${s.daily.credit}</div>
                        <div class="glass p-4 text-green-400 tracking-widest">CASH: â‚ª${s.daily.cash}</div>
                        <div class="glass p-4 text-indigo-400 tracking-widest">TIPS: â‚ª${s.daily.tips}</div>
                        <div class="glass p-4 text-white tracking-widest">PEAK: ${s.peak}</div>
                    </div>
                    <div class="text-[10px] text-gray-500 uppercase tracking-widest italic">×¢×•×‘×“ ××—×¨××™: ${s.staff}</div>
                </div>
            </div>`).join('');
    }

    function addExpense() {
        const d = document.getElementById('exp-desc').value, a = parseFloat(document.getElementById('exp-amt').value);
        if(d && a) { daily.expenses.push({ desc: d, amt: a }); save(); render(); document.getElementById('exp-desc').value=''; document.getElementById('exp-amt').value=''; }
    }

    function renderExpenses() {
        const list = document.getElementById('expenses-list');
        if(list) list.innerHTML = daily.expenses.map(e => `<div class="flex justify-between glass p-4 text-xs font-bold border-white/5"><span>${e.desc}</span><span class="text-red-400 font-black">â‚ª${e.amt}</span></div>`).join('');
    }

    function renderStats() {
        const grid = document.getElementById('analytics-grid');
        if(!grid) return;
        const peak = Object.entries(daily.hours).sort((a,b)=>b[1]-a[1])[0];
        grid.innerHTML = `
            <div class="glass p-8"><h3 class="text-indigo-400 font-black mb-6 uppercase text-[9px] tracking-widest">ğŸ† ×˜×¢××™×</h3>${Object.entries(daily.flavors).sort((a,b)=>b[1]-a[1]).slice(0,5).map(([n,q])=>`<div class="flex justify-between text-sm py-2 border-b border-white/5"><span>${n}</span><b>${q}</b></div>`).join('') || '<div class="text-gray-500 text-xs">××™×Ÿ × ×ª×•× ×™×</div>'}</div>
            <div class="glass p-8 text-center"><h3 class="text-indigo-400 font-black mb-6 uppercase text-[9px] tracking-widest">â° ×©×¢×ª ×©×™×</h3><div class="text-5xl font-black py-4">${peak ? peak[0]+':00' : '--:--'}</div></div>
            <div class="glass p-8 md:col-span-2 flex justify-around"><div class="text-center"><h3 class="text-gray-500 font-bold text-[8px] mb-1">××©×¨××™</h3><b class="text-blue-400 text-3xl font-black italic">â‚ª${daily.credit}</b></div><div class="text-center"><h3 class="text-gray-500 font-bold text-[8px] mb-1">××–×•××Ÿ</h3><b class="text-green-400 text-3xl font-black italic">â‚ª${daily.cash}</b></div></div>
        `;
    }

    function openAddTableModal() { const modal = document.getElementById('modal-content'); modal.innerHTML = `<div class="text-center p-4"><h2 class="text-2xl font-black mb-8 uppercase tracking-tighter">×¤×ª×— ×©×•×œ×—×Ÿ</h2><input type="text" id="new-name" placeholder="×©×/××¡×¤×¨" class="w-full glass bg-transparent rounded-3xl p-6 text-center text-4xl font-black outline-none border border-white/10 mb-8"><button onclick="addTable()" class="w-full bg-white text-black py-5 rounded-3xl font-black text-xl shadow-xl">×¦×•×¨ ×©×•×œ×—×Ÿ</button></div>`; document.getElementById('modal-container').classList.remove('hidden'); }
    function addTable() { const n = document.getElementById('new-name').value; if(!n) return; const id = 't'+Date.now(); tables.push({ id, name: n, hue: Math.floor(Math.random()*360), items: [], paid: false, stage: 0, start: null, staff: document.getElementById('current-staff-name').textContent }); save(); openTableModal(id); }
    function skipTimer(id) { const t = tables.find(x=>x.id===id); if(t){ t.stage++; t.start=Date.now(); save(); render(); } }
    function deleteTable(id) { if(confirm("×œ××—×•×§ ×©×•×œ×—×Ÿ?")) { tables=tables.filter(x=>x.id!==id); save(); render(); } }
    function deleteArchiveEntry(id) { if(confirm("×œ××—×•×§ ××©××¨×ª ×–×•?")) { archive=archive.filter(x=>x.id!=id); save(); render(); } }
    function addItem(tid, mid) { const t=tables.find(x=>x.id===tid), m=menuItems.find(x=>x.id===mid); if(t){ const ex=t.items.find(x=>x.id===mid); if(ex) ex.qty++; else t.items.push({...m,qty:1}); t.items.forEach(i => daily.flavors[i.name] = (daily.flavors[i.name] || 0) + i.qty); save(); openTableModal(tid); } }
    function removeItem(tid, mid) { const t=tables.find(x=>x.id===tid); if(t){ t.items=t.items.filter(x=>x.id!==mid); save(); openTableModal(tid); } }
    function updateNotes(id, val) { const t=tables.find(x=>x.id===id); if(t){ t.notes=val; save(); } }
    function switchTab(id) { currentTab=id; document.querySelectorAll('.view-content').forEach(v=>v.classList.add('hidden')); document.getElementById('view-'+id).classList.remove('hidden'); document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('tab-active','text-white')); document.getElementById('tab-'+id).classList.add('tab-active'); render(); }
    function closeModal() { document.getElementById('modal-container').classList.add('hidden'); }
    function changeUser() { const u=prompt("×©× ×¢×•×‘×“:"); if(u) { document.getElementById('current-staff-name').textContent=u; localStorage.setItem('atmos_staff',u); } }
    function updateClock() { const now=new Date(); const d = now.toLocaleDateString('he-IL', {day:'2-digit',month:'2-digit',year:'2-digit'}); document.getElementById('date-time-display').innerHTML = `${now.toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit'})}<br>${d}`; }

    init();
  </script>
 </body>
</html>
