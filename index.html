<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATMOS - ניהול נרגילות</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: sans-serif; background-color: #0f172a; color: white; margin: 0; }
        .tab-active { background: #4f46e5; color: white; }
        .modal-open { display: flex !important; }
        .table-card { border-top: 4px solid #6366f1; }
        .closed-table { opacity: 0.5; filter: grayscale(1); }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <header class="bg-gray-900 border-b border-gray-800 p-4 flex justify-between items-center shadow-lg">
        <h1 class="text-xl font-bold tracking-widest text-indigo-400">ATMOS LOUNGE</h1>
        <div class="text-sm bg-gray-800 px-3 py-1 rounded-lg border border-gray-700">
            עובד: <span id="staff-name-ui" class="font-bold">מנהל</span>
            <button onclick="changeUser()" class="mr-2 text-xs text-indigo-400 underline italic">החלף</button>
        </div>
    </header>

    <nav class="bg-gray-900 flex p-2 gap-2 border-b border-gray-800 shadow-md">
        <button onclick="switchTab('tables')" id="tab-tables" class="tab-active flex-1 py-2 rounded-lg font-bold text-sm">שולחנות</button>
        <button onclick="switchTab('inventory')" id="tab-inventory" class="bg-gray-800 flex-1 py-2 rounded-lg font-bold text-sm text-gray-400">מלאי טבק</button>
        <button onclick="switchTab('daily')" id="tab-daily" class="bg-gray-800 flex-1 py-2 rounded-lg font-bold text-sm text-gray-400">סיכום יום</button>
    </nav>

    <main class="flex-1 overflow-y-auto p-4 space-y-6">
        
        <div id="view-tables">
            <div class="flex justify-between items-center mb-4">
                <h2 class="font-bold text-gray-400">שולחנות פעילים</h2>
                <button onclick="openAddModal()" class="bg-indigo-600 px-4 py-2 rounded-xl font-bold text-sm">+ פתח שולחן</button>
            </div>
            <div id="grid-active" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3"></div>
            
            <div class="mt-10 pt-6 border-t border-gray-800">
                <h2 class="font-bold text-gray-600 mb-4 text-sm uppercase">שולחנות סגורים</h2>
                <div id="grid-closed" class="grid grid-cols-2 md:grid-cols-6 gap-3"></div>
            </div>
        </div>

        <div id="view-inventory" class="hidden">
            <h2 class="text-xl font-bold mb-4">מלאי טבקים (צפייה בלבד)</h2>
            <div id="inventory-list" class="grid grid-cols-1 md:grid-cols-3 gap-3"></div>
        </div>

        <div id="view-daily" class="hidden">
            <div class="bg-gray-800 p-6 rounded-2xl border border-gray-700 max-w-sm mx-auto text-center">
                <h2 class="text-indigo-400 font-bold mb-6">סיכום משמרת</h2>
                <div class="space-y-3">
                    <div class="flex justify-between"><span>סה"כ הכנסה:</span> <span id="ui-rev" class="text-green-400 font-bold">₪0</span></div>
                    <div class="flex justify-between"><span>הזמנות:</span> <span id="ui-orders" class="font-bold">0</span></div>
                </div>
                <button onclick="resetAllData()" class="mt-8 text-red-500 text-xs underline">איפוס נתונים כללי</button>
            </div>
        </div>
    </main>

    <div id="modal" class="hidden fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4">
        <div class="bg-gray-900 w-full max-w-md rounded-3xl border border-gray-700 overflow-hidden" onclick="event.stopPropagation()">
            <div id="modal-body"></div>
        </div>
    </div>

    <script>
        // נתונים ראשוניים
        const TOBACCO = [
            { id: 't1', name: 'Pinkman', cat: 'Musthave', price: 85 },
            { id: 't2', name: 'Lemon Mint', cat: 'Mono', price: 80 },
            { id: 't3', name: 'Ice Blueberry Mint', cat: 'Mono', price: 80 },
            { id: 't4', name: 'Space Flavor', cat: 'Musthave', price: 90 },
            { id: 't5', name: 'chill%thrill', cat: 'Mix', price: 95 }
        ];

        let tables = JSON.parse(localStorage.getItem('atmos_tables')) || [];
        let daily = JSON.parse(localStorage.getItem('atmos_daily')) || { rev: 0, orders: 0 };

        // פונקציות עזר
        const save = () => {
            localStorage.setItem('atmos_tables', JSON.stringify(tables));
            localStorage.setItem('atmos_daily', JSON.stringify(daily));
        };

        // רינדור השולחנות
        function render() {
            const activeDiv = document.getElementById('grid-active');
            const closedDiv = document.getElementById('grid-closed');
            activeDiv.innerHTML = ''; closedDiv.innerHTML = '';

            tables.forEach(t => {
                const card = document.createElement('div');
                card.className = `table-card bg-gray-800 p-4 rounded-xl cursor-pointer ${t.paid ? 'closed-table' : ''}`;
                card.onclick = () => openTableDetails(t.id);
                card.innerHTML = `<div class="font-bold">${t.name}</div><div class="text-xs text-indigo-400">${t.paid ? 'שולם' : 'פעיל'}</div>`;
                (t.paid ? closedDiv : activeDiv).appendChild(card);
            });

            document.getElementById('ui-rev').innerText = `₪${daily.rev}`;
            document.getElementById('ui-orders').innerText = daily.orders;

            const invDiv = document.getElementById('inventory-list');
            invDiv.innerHTML = TOBACCO.map(i => `<div class="bg-gray-800 p-3 rounded-lg border border-gray-700 flex justify-between"><span>${i.name}</span><span class="text-gray-500 text-xs">${i.cat}</span></div>`).join('');
        }

        // ניהול טאבים
        function switchTab(tabId) {
            ['tables', 'inventory', 'daily'].forEach(id => {
                document.getElementById('view-' + id).classList.add('hidden');
                document.getElementById('tab-' + id).classList.remove('tab-active');
                document.getElementById('tab-' + id).classList.add('bg-gray-800', 'text-gray-400');
            });
            document.getElementById('view-' + tabId).classList.remove('hidden');
            document.getElementById('tab-' + tabId).classList.add('tab-active');
            document.getElementById('tab-' + tabId).classList.remove('bg-gray-800', 'text-gray-400');
        }

        // מודאלים
        function openAddModal() {
            const modal = document.getElementById('modal');
            const body = document.getElementById('modal-body');
            body.innerHTML = `
                <div class="p-6 text-center">
                    <h2 class="text-xl font-bold mb-4">פתיחת שולחן</h2>
                    <input id="new-name" type="text" placeholder="מספר/שם שולחן" class="w-full bg-gray-800 p-4 rounded-xl text-white mb-4 border border-gray-700">
                    <button onclick="addTable()" class="w-full bg-indigo-600 py-4 rounded-xl font-bold">צור שולחן</button>
                    <button onclick="closeModal()" class="mt-4 text-gray-500">ביטול</button>
                </div>
            `;
            modal.classList.remove('hidden');
            modal.classList.add('modal-open');
        }

        function addTable() {
            const name = document.getElementById('new-name').value;
            if (!name) return;
            tables.push({ id: Date.now(), name, items: [], paid: false });
            save(); closeModal(); render();
        }

        function openTableDetails(id) {
            const t = tables.find(x => x.id === id);
            const total = t.items.reduce((a, b) => a + b.price, 0);
            const body = document.getElementById('modal-body');
            body.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between mb-4">
                        <h2 class="text-2xl font-black">${t.name}</h2>
                        <button onclick="closeModal()" class="text-gray-500">✕</button>
                    </div>
                    <div class="bg-gray-800 p-4 rounded-xl mb-4">
                        <div class="text-xs text-gray-500 mb-2 uppercase">פריטים בהזמנה (₪${total}):</div>
                        <div class="space-y-1">${t.items.map(i => `<div class="text-sm border-b border-gray-700 pb-1">${i.name} - ₪${i.price}</div>`).join('')}</div>
                    </div>
                    <div class="grid grid-cols-2 gap-2 mb-6">
                        ${TOBACCO.map(m => `<button onclick="addItemToTable(${id}, '${m.id}')" class="bg-gray-800 p-2 rounded-lg text-xs border border-gray-700">${m.name}</button>`).join('')}
                    </div>
                    ${!t.paid ? `<button onclick="payTable(${id}, ${total})" class="w-full bg-green-600 py-4 rounded-xl font-bold">סגור שולחן ותשלום</button>` : `<div class="text-center text-gray-500">שולחן סגור</div>`}
                </div>
            `;
            document.getElementById('modal').classList.remove('hidden');
            document.getElementById('modal').classList.add('modal-open');
        }

        function addItemToTable(tid, mid) {
            const t = tables.find(x => x.id === tid);
            const m = TOBACCO.find(x => x.id === mid);
            t.items.push({...m});
            save(); openTableDetails(tid);
        }

        function payTable(id, amt) {
            const t = tables.find(x => x.id === id);
            t.paid = true;
            daily.rev += amt;
            daily.orders++;
            save(); closeModal(); render();
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
            document.getElementById('modal').classList.remove('modal-open');
        }

        function changeUser() {
            const n = prompt("שם עובד:");
            if (n) document.getElementById('staff-name-ui').innerText = n;
        }

        function resetAllData() {
            if (confirm("לאפס הכל?")) {
                localStorage.clear();
                location.reload();
            }
        }

        // הפעלה ראשונית
        window.onload = function() {
            render();
        };
    </script>
</body>
</html>
